---
title: "Put a real title here"
subtitle: "SDS 192: MP5"
author: 
- name: Sethatevy Bong
  affiliation: Smith College
- name: Esa Schenck
  affiliation: Smith College
-name: Veronica Kessler  
date: "`r format(Sys.Date(), '%B %e, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
    code_folding: show
    df_print: paged
editor_options: 
  chunk_output_type: inline
references:
- id: xie2016bookdown
  type: book
  title: "Bookdown: Authoring books and technical documents with R markdown"
  author: 
  - family: Xie
    given: Yihui
  issued:
    year: 2016
  publisher: CRC Press
  url: https://bookdown.org/yihui/rmarkdown/
---


```{r setup, include=FALSE}
library(tidyverse)
library(sds192)
library(RMySQL)
library(leaflet)
library(sf)
library(ggthemes)
db <- dbConnect(
  MySQL(), 
  host = "scidb.smith.edu", 
  user = "sds192", 
  password = "DSismfc@S", 
  dbname = "airlines"
)
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE, 
  connection = db, 
  max.print = 20
)
```


## Introduction

What is this article about? [^github]

This article is about arguing whether age and gender are drivers for use the citibike system in New YorK and weather this could be a rationale tied to climate change perceptions. We also seek to expose the areas of higher confluence in the city for the use of these bikes.


![faulty graph](Screen Shot 2020-12-12 at 01.23.02.png)

(*Image from:* https://www.documentcloud.org/documents/6566049-Benefits-of-Fossil-Fuels-and-CO2-for-Human-and.html)

Unfortunately, misleading language that is based on unclear graphical data is used within the debate around the belief in climate change. For instance, this graph is being used in [a slide presentation](https://www.documentcloud.org/documents/6566049-Benefits-of-Fossil-Fuels-and-CO2-for-Human-and.html)by Mr. Indur M. Goklany, who was a longtime Interior Department employee and has promoted to work under the office of deputy secretary during the early days of the Trump administration to assist with the revision of climate policies([*The New York Times*](https://www.nytimes.com/2020/03/02/climate/goks-uncertainty-language-interior.html). Mr. Goklany was promoting the benefits of fossil fuels and carbon dioxide to human and environmental well-being([*The New York Times*](https://www.nytimes.com/2020/03/02/climate/goks-uncertainty-language-interior.html). He is known for his "uncertainty language" about climate change and is believed to contribute to the misrepresentation scientific census about the detrimental effects of climate change(*The New York Times*). Without information about the evolution of healthcare systems with respect to this graph, it is imprecise and wrong for Mr. Indur M. Goklany to argue that the increase of CO2 improves human's life expectancy.
Hence, to avoid misleading interpretation, our article is using trustworthy data directly from CitiBikes to display a holistic visualization and context for our discussions about the perception of climate change and the usage of Citibike in New York City.


[^github]: Please see [our GitHub repository](https://github.com/sds192-s20/mp3-group-*) for complete code. 

## Exploratory data analysis

```{sql, connection=db, output.var = "Trips_during_school_year"}
SELECT duration, birth_year, gender, start_station_id FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber'
AND stop_time < '2017-06-01#' OR start_time > '2017-09-01#';
```


# We want to group those users younger than 30 and older than 30 to know which group uses the bike system more frequently

```{sql connection=db, output.var = "Trips"}
SELECT duration, birth_year, gender
 FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber';

```

```{r}
Trips_Age <- Trips %>% 
  mutate(age_category = ifelse(birth_year >= 1987, "Thirthy or Younger", "Older Than Thirty"))
```


## In our first graph we plotted it the total trips people of each age group took in 2017. We found that  older than 30-year old people use the systems more than 30-year old or younger. With people aged 25 and 32 being the group using the bike system more 25 thousand trips a year

```{r}
Trips_Age %>% 
  group_by(birth_year, age_category) %>% 
   summarize(total = sum(n())/10000) %>%
  ggplot(aes(x = birth_year, y = total, fill= age_category)) + 
  geom_col()+
  scale_fill_manual(values = c("blue", "lightblue"))+
  xlim(c(1957, 2005))+
   labs (title = " Use of the Citibike System According to Age in 2017")+
  labs(y= "Total Trips in Tens of Thousands", x= "Birth Year")+
  labs(fill= "Age Category")+
  theme(plot.title = element_text(colour = "black", hjust = 0.5, face = "bold"))
 
```


### In our second graph we wanted to find out which gender is more likely to use the bike system in New York City. We found that men are more incline than women to ride the public bikes.

```{r}
Trips %>% 
  group_by(birth_year, gender) %>% 
  filter(birth_year >= 1957, gender != 0) %>%
  mutate(gender = ifelse(gender == 1, "Male", "Female")) %>% 
  summarize(total = sum(n())) %>%
  ggplot(aes(x = birth_year, y = total, fill = gender)) + 
  geom_col()+
   scale_fill_manual(values =c("Pink", "lightblue"))+
  labs(title = "Gender Usage of the Bike System in 2017")+
  theme(plot.title = element_text(colour = "black", hjust = 0.4, face = "bold"))+
  labs(x= "Birth Year", y = "Total duration Trips?")+
    labs(fill = "Gender")
  
```

Please see the [SQL chapter of the `bookdown` book](
https://rmarkdown.rstudio.com/authoring_knitr_engines.html%23sql#sql) for more information. 

You can cite references using parentheses or not. @xie2016bookdown wrote about this. See also [@xie2016bookdown].




```{sql connection=db, output.var = "Trips"}
SELECT duration, birth_year, gender
 FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber';

```

# Station Data

```{sql connection=db, output.var = "months_station"}
SELECT station_id, name, num_starts, num_stops, avg_lat, avg_lon
 FROM citibike.station_months 
```

What stations get the most average rides (both starts and stops)?
Average numbers of trips per month:

```{r}
months_station_2 <- months_station %>% 
  #select(-station_id) %>% 
  mutate(trips = num_starts + num_stops) %>% 
  group_by(name) %>% 
  summarize(total_months = sum(n()),
            total_starts = sum(num_starts), 
          avg_trips = total_starts/total_months,
          avg_lat = first(avg_lat),
          avg_lon = first(avg_lon)
         )
```



# Station Data


```{r}
 Top_50_Stations <- months_station_2 %>%
 head(50) 
station_pal <- colorNumeric(
  palette = c("#FF9999", "#FF0000"), 
  domain = Top_50_Stations %>%
    pull(avg_trips) %>%
    range())


leaflet(Top_50_Stations) %>% 
  addTiles() %>%
  addCircles(lng = ~avg_lon, lat = ~avg_lat, weight = 3,
    radius = ~sqrt(avg_trips)*3,
    color = ~station_pal(avg_trips), popup = paste("<b>",Top_50_Stations$name, "</b>", "<br>",
                           "Average Number of Bicycles Used:", round(Top_50_Stations$avg_trips,2)),opacity = 100)
```






## Analysis

What did you discover? 

## Conclusion

What did you *learn* about the data set your explored?  

---

## Word count

```{r word_count, message=FALSE, echo=FALSE}
sds192::text_stats()
```


## Standards

In this assignment, we are attempting the following standards:

```{r buttons, echo=FALSE}
standard_button("markdown")
standard_button("aesthetics")
standard_button("wrangling")
standard_button("context")
standard_button("reshape")
standard_button("relational")
standard_button("ethics")
standard_button("github")
standard_button("iteration")
standard_button("function")
standard_button("spatial")
standard_button("leaflet")
standard_button("query")
```

## References

