---

title: "**The power of Bicycles to Fight Climate Change**"
subtitle: "SDS 192: MP5"
author: 
- name: Sethatevy Bong
  affiliation: Smith College
- name: Esa Schenck
  affiliation: Smith College
- name: Veronica Kessler  
  affiliation: Smith College
date: "`r format(Sys.Date(), '%B %e, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
    code_folding: show
    df_print: paged
editor_options: 
  chunk_output_type: inline
references:
- id: xie2016bookdown
  type: book
  title: "Bookdown: Authoring books and technical documents with R markdown"
  author: 
  - family: Xie
    given: Yihui
  issued:
    year: 2016
  publisher: CRC Press
  url: https://bookdown.org/yihui/rmarkdown/
---


```{r setup, include=FALSE}
library(tidyverse)
library(sds192)
library(RMySQL)
library(leaflet)
library(sf)
library(ggthemes)
library(RColorBrewer)

db <- dbConnect(
  MySQL(), 
  host = "scidb.smith.edu", 
  user = "sds192", 
  password = "DSismfc@S", 
  dbname = "airlines"
)
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE, 
  connection = db, 
  max.print = 20
)
```


## Introduction

  Have you wondered about the power of bicycles to fight climate change? 

 Last spring when a friend of mine at Smith told me that she wanted a car so she could have more independence, I immediately screamed inside myself thinking in the tons of carbon dioxide that that car would deliver to the environment in its lifespan.  I told her that she should wait to have a lot of money and buy an electric car instead or get a bicycle in the meantime. She laughed and seemed to agree. Our decisions today have a long and imperceptible effect especially when we talk about global warming and climate change.

 According to [NASA](https://climate.nasa.gov/causes/) there are several gases in the atmosphere trapping heat. One of those gases is carbon dioxide (CO2). This gas is released into the atmosphere through various natural processes and mostly, activities caused only by humans.  Deforestation and burning of fossil fuels are the primary drivers of carbon emissions. We have increased the levels of CO2 by 47% since the industrial revolution.

 Last year, in October, [Smith College divested from fossil fuels](https://www.smith.edu/president-kathleen-mccartney/letters/2019-20/fossil-fuels-and-smith-endowment ). The college voted to exclude Smith's endowment from any future investment with such industry. 
 This was a major victory for students who pressured for such change and for the community in general. It is a step we are convinced other colleges and universities will follow as well.

  Last year we also got acquainted with the eloquence and determination of a 17 year old Swiss red haired girl. I remember her clearly for her bold statement: “How dare you? You have stolen my dreams and my childhood with your empty words” (Greta Thunberg to World leaders- YouTube).
Greta Thunberg, an student and environmental activist, became the youngest and most outspoken critic of the lack of global policies to fight climate change. Perhaps the most heroic act we might remember about Ms. Thunberg is her decision to sail instead of flying from Europe to the United States to attend the 2019 UN Climate Action Summit. 


```{r, echo=FALSE}
library(vembedr)
 embed_url("https://www.youtube.com/watch?v=TMrtLsQbaok") %>% 
   use_start_time ("1m12") %>% 
   use_align ("center")
```


  What does all of that has to do with the citylike system in New York City and the data presented in this project? 

  According to a Greenhouse Gas emission report for NYC in 2016, 30% of the city emissions came from the transportation system. Cars are the largest generators of emission with 96% footprint. Cars powered with gasoline composed 80% of the transportation base emissions. See figures 1 and 2. [^1]

**Figure 1.** 

![](NYC ANNUAL EMISSIONS BY SOURCE.png)

**Figure 2.**

![](NYC EMISSIONS BY SECTOR.png)


In this perspective, we could follow the example of the Netherlands, Denmark, the United Kingdom  and Germany that have incentivized the use of bicycles and discourage the use of cars by imposing heavy taxes on gasoline. Bikes can be used to reduce carbon emissions and mitigate climate change. Promoting the use of bicycles is essential to mitigate the effect of climate change and local government must facilitate adequate financial support.


**What is this article about?**

This article is about arguing whether age and gender are drivers for use the citibike system in New YorK and weather this could be a rationale tied to climate change perceptions. We also seek to expose the areas of higher confluence in the city for the use of these bikes.


![](Screen Shot 2020-12-12 at 01.23.02.png)

(*Source:* https://www.documentcloud.org/documents/6566049-Benefits-of-Fossil-Fuels-and-CO2-for-Human-and.html)

Unfortunately, misleading language that is based on unclear graphical data is used within the debate around the belief in climate change. For instance, this graph is being used in [a slide presentation](https://www.documentcloud.org/documents/6566049-Benefits-of-Fossil-Fuels-and-CO2-for-Human-and.html) by Mr. Indur M. Goklany, longtime Interior Department employee, who was promoted to work under the office of deputy secretary during the early days of the Trump administration to assist with the revision of climate policies([*The New York Times*](https://www.nytimes.com/2020/03/02/climate/goks-uncertainty-language-interior.html).

Mr. Goklany was promoting the benefits of fossil fuels and carbon dioxide to human and environmental well-being [*The New York Times*](https://www.nytimes.com/2020/03/02/climate/goks-uncertainty-language-interior.html). He is known for his "uncertainty language" about climate change and is believed to contribute to the misrepresentation scientific census about the detrimental effects of climate change *The New York Times*). 

Without information about the evolution of healthcare systems with respect to this graph, it is imprecise and wrong for Mr. Indur M. Goklany to argue that the increase of CO2 improves human's life expectancy.
Hence, to avoid misleading interpretation, our article is using trustworthy data directly from CitiBikes to display a holistic visualization and context for our discussions about the perception of climate change and the usage of Citibike in New York City.


## Our data:

Note : The data that we used was [citibikenyc](https://www.citibikenyc.com/system-data).  Trips made by staff members in their labor activities were removed as well as any trips lower than 60 second as they were false starts. 

  With our data we wanted to find the relationship between bike usage in NYC and weather temperature. Thus, this article will help us to determine whether age and gender are drivers for use the citibike system in New York and weather this could be a rationale tied to climate change perceptions. We also seek to expose the areas of higher confluence in the city for the use of these bikes.

 **Exploratory data analysis**

```{sql, connection=db, output.var = "Trips_during_school_year"}
SELECT duration, birth_year, gender, start_station_id FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber'
AND stop_time < '2017-06-01#' OR start_time > '2017-09-01#';
```

  Our first step consisted in grouping those users younger than 30 and older than 30 to know which group uses the bike system more frequently.

```{sql connection=db, output.var = "Trips"}
SELECT duration, birth_year, gender
 FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber';

```

```{r}
Trips_Age <- Trips %>% 
  mutate(age_category = ifelse(birth_year >= 1987, "Thirthy or Younger", "Older Than Thirty"))
```


  Having extracted the data from SQL, in our first graph we plotted it the total trips people of each age group took in 2017. We found that  older than 30-year old people use the systems more than 30-year old or younger. With people aged 25 and 32 being the group using the bike system more than 25 thousand trips a year.
  
  We were hoping to have more younger folks using the bike system since the common believe is that younger Americas worry about climate change more than older generations. In fact, a 2018 report by Gallup showed that because younger Americans are growing up with more exposure to the effects of Climate Change the polls often show that 70% of younger adults (ages 18-34) worry about global warming while people ages 55 and older worry less.[^2]
  
  Nevertheless scholar from Yale University also concluded that although it might seeem like younger Americans worry more about climate change, they dont always engage in activities to help mitigate their impacts. [^3]

```{r, warning=FALSE, fig.width=9, fig.height=7}
Trips_Age %>% 
  group_by(birth_year, age_category) %>% 
   summarize(total = sum(n())) %>%
  ggplot(aes(x = birth_year, y = total, fill= age_category)) + 
  geom_col()+
  scale_fill_manual(values = c("blue", "lightblue"))+
  xlim(c(1957, 2005))+
   labs (title = " Use of the Citibike System According to Age in 2017")+
  labs(y= "Total Trips", x= "Birth Year")+
  labs(fill= "Age Category")+
  theme(plot.title = element_text(colour = "black", hjust = 0.5, face = "bold"))+
  scale_y_continuous(labels = scales::comma)
 
```

  In our second graph we wanted to find out which gender is more likely to use the bike system in New York City independent of the age. Our coding displayed that men ride the public bikes more women.This results were unexpected since the general thought portrays women are more mindful of activities that help the environment. refer to this article by the Guardian.com [The eco gender gap: why is saving the planet seen as women’s work?](https://www.theguardian.com/environment/2020/feb/06/eco-gender-gap-why-saving-planet-seen-womens-work). In any way we thought that the fact that in NYC more men that women use the bike system has to do with other variables such outfit women wear and the type of jobs they hold without necessarily compromising their concern for climate change. However, this is just our opinion not proven scientifically.

```{r, fig.width=7, fig.height=5}
Trips %>% 
  group_by(birth_year, gender) %>% 
  filter(birth_year >= 1957, gender != 0) %>%
  mutate(gender = ifelse(gender == 1, "Male", "Female")) %>% 
  summarize(total = sum(n())) %>%
  ggplot(aes(x = birth_year, y = total, fill = gender)) + 
  geom_col()+
   scale_fill_manual(values =c("Pink", "lightblue"))+
  labs(title = "Gender Usage of the Bike System in 2017")+
  theme(plot.title = element_text(colour = "black", hjust = 0.4, face = "bold"))+
  labs(x= "Birth Year", y = "Total Trips")+
    labs(fill = "Gender")+
  scale_y_continuous(labels = scales::comma)
  
```

```{sql connection=db, output.var = "Trips"}
SELECT duration, birth_year, gender
 FROM citibike.trips
WHERE duration > 600
AND user_type = 'subscriber';

```

```{sql connection=db, output.var = "months_station"}
SELECT station_id, name, num_starts, num_stops, avg_lat, avg_lon
 FROM citibike.station_months 
```

What stations get the most average rides (both starts and stops)?
Average numbers of trips per month:

```{r}
months_station_2 <- months_station %>% 
  #select(-station_id) %>% 
  mutate(trips = num_starts + num_stops) %>% 
  group_by(name) %>% 
  summarize(total_months = sum(n()),
            total_starts = sum(num_starts), 
          avg_trips = total_starts/total_months,
          avg_lat = first(avg_lat),
          avg_lon = first(avg_lon)
         )
```



```{r}
 Top_50_Stations <- months_station_2 %>%
 head(50) 
station_pal <- colorNumeric(
  palette = c("#FF9999", "#FF0000"), 
  domain = Top_50_Stations %>%
    pull(avg_trips) %>%
    range())


leaflet(Top_50_Stations) %>% 
  addTiles() %>%
  addCircles(lng = ~avg_lon, lat = ~avg_lat, weight = 3,
    radius = ~sqrt(avg_trips)*3,
    color = ~station_pal(avg_trips), popup = paste("<b>",Top_50_Stations$name, "</b>", "<br>", "Average Number of Bicycles Used:", Top_50_Stations$avg_trips),opacity = 100)
```

# How does weather affect bike trips?

While biking is a great way for individuals to lower their personal carbon emissions, it's not always accessible. Weather conditions can deter potential bike riders, and its challenges range from minor inconveniences (such as light rain) to major risks (such as ice). How do weather conditions affect daily citibike trips -- and, by extension, daily carbon reduction?

```{r}
#loading the data
#This weather data was accessed through NOAA and was collected in Central Park. The numbers may not exactly reflect weather conditions throughout the entire city.
weather_data <- read.csv("weather2017.csv")
```
```{r}
#The reason why we reshaped the data to make it long was because we wanted to use precipitation (total precip -- both rain and snow) as one variable that we could plot against variables such as number of rides, but we also wanted to keep the distinction (so that we could see the difference in rain and snow)
weather_data_long <- weather_data %>%
  mutate("RAIN" = PRCP) %>% 
  pivot_longer(c(RAIN, SNOW), names_to = "prcp_type", values_to = "amount")

```

```{sql connection=db, output.var = "all_trips"}
SELECT CAST(start_time AS DATE) AS time
 FROM citibike.trips;
```
```{r}
#Note for SQL chunk (above): to convert the date data type I used resources https://www.essentialsql.com/datatype-conversion-in-sql-using-cast-and-convert/ and https://www.w3schools.com/sql/sql_datatypes.asp
#Converting the datetime format to only date was important for grouping the number of trips by data and for joining the trips data with the weather data (which was daily)

#Since "time" is now date, grouping by time means that we can find the number of trips per day taken in the entire citibike system (subscribers AND one-time customers)
all_trips_grouped <- all_trips %>% 
  group_by(time) %>% 
  summarize(num_trips = n())
```

```{r}
#Joining the trips and weather data
trips_weather <- weather_data_long %>% 
  full_join(all_trips_grouped, by=c('DATE'='time')) 

trips_weather[is.na(trips_weather)] <- 0
```
## The affect of precipitaion

```{r}
#Type & amount of precipiation against citibike trips
trips_weather %>% 
  filter(amount > 0) %>% 
  ggplot(aes(x = amount, y = num_trips, color = prcp_type)) + 
  geom_point() +
  scale_y_continuous("Number of Citibike Trips", labels = scales::comma) +
  scale_x_continuous("Amount of Precipitation (in)") +
  scale_color_manual("Type", values = c('darkblue', 'deepskyblue'), labels = c("Rain", "Snow")) +
  labs(title = "How Precipitation Affects Daily Citibike Trips", subtitle = "Excluding days without rain or snow")
```
"When it rains, it pours" is not always an accurate statement. The graph above depicts the inches of rain or snow which accumulate *on days when there is precipitation* and its affect on number of Citibike trips. Few days in NYC see more than an inch of precipitation, and mild rain doesn't seem to correlate with a reduction in bike trips. However, there does seem to be a reduction in trips on days with more than 2 inches of precipitation, especially for snow. Although snowfall is relatively rare, heavy snow seems to significantly deter riders from using bikes.

The biggest question left over from this graph is: If low precipitation doesn't correlate with number of trips, why is the range of trips on low-precip. days so varied? The next figure provides an answer.


```{r}
#Temperature analysis (how temp -- and also precip -- affect number of rides)
trips_weather %>% 
  group_by(DATE) %>% 
  mutate(total_prcp = sum(amount),
         Precipitation = case_when(total_prcp >= 2 ~ 'High',  #help with case when from https://www.statology.org/conditional-mutating-r/
                                   total_prcp >= 1 ~ 'Medium',
                                   total_prcp < 1 ~ 'Low'))%>% 
  ggplot(aes(x = TMAX, y = num_trips)) + 
  geom_point(aes(color = total_prcp) ) +
  geom_smooth(color = "grey1") +
  scale_color_distiller("Precipitation (in)", palette = "Blues", values = c(0.001, 1), na.value = "white", direction = 1) +
  #theme_dark() +
  scale_y_continuous("Number of Citibike Trips", labels = scales::comma) +
  scale_x_continuous("Daily Max. Temperature (F)") +
  labs(title = "How Temperature & Precipitation Affect Daily Citibike Trips", subtitle = "Days without precipitation colored in white")
```

This graph shows that there is association between daily temperature and number of Citibike trips, with trips increasing as temperature increases until about 80*F, at which point there is a slight decrease. Although days with precipitation generally have fewer riders than dry days at similar temperatures, there is only clear decrease in ridership on days with high precipitation.


## Seasonal Citibike ridership: a worrying trend?

```{r}
#Number of trips over time (ie date), also colored by temp.
trips_weather %>%
  #filter((DATE >= "2017-02-1") & (DATE <= "2017-03-21")) %>% 
  group_by(DATE) %>% 
  mutate(total_prcp = sum(amount),
         Precipitation = case_when(total_prcp >= 2 ~ 'High',
                                   total_prcp >= 1 ~ 'Medium',
                                   total_prcp < 1 ~ 'Low')) %>% 
  ggplot(aes(x = DATE, y = num_trips, color = TMAX)) + 
  geom_point() +
  scale_color_distiller("Temperature (F)", palette = "RdYlBu") +
  scale_y_continuous("Number of Citibike Trips", labels = scales::comma) +
  scale_x_discrete("Date in 2017", breaks = c("2017-01-01", "2017-02-01", "2017-03-01", "2017-04-01", "2017-05-01", "2017-06-01", "2017-07-01", "2017-08-01", "2017-09-01", "2017-10-01", "2017-11-01", "2017-12-01"), labels = c("Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun.", "Jul.", "Aug.", "Sept.", "Oct.", "Nov.", "Dec.")) +
  labs(title = "Daily Citibike Trips Throughout 2017")
```

As earlier demonstrated, there is a strong association between temperature and Citibike ridership. This graph demonstrates that, since temperature in NYC changes drastically between seasons, the number of Citibike trips changes drastically as well. Many fewer daily rides are taken during the winter months than in summer, which could complicate any systemic shift towards bikes as a carbon-neutral transportation.



## Word count

```{r word_count, message=FALSE, echo=FALSE}
sds192::text_stats()
```


## Standards

In this assignment, we are attempting the following standards:

```{r buttons, echo=FALSE}
standard_button("markdown")
standard_button("aesthetics")
standard_button("wrangling")
standard_button("context")
standard_button("reshape")
standard_button("relational")
standard_button("ethics")
standard_button("github")
standard_button("iteration")
standard_button("function")
standard_button("spatial")
standard_button("leaflet")
standard_button("query")
```

## References
[^1]: [Inventory of New York City Greenhouse Gas Emissions in 2016](https://www1.nyc.gov/assets/sustainability/downloads/pdf/publications/GHG%20Inventory%20Report%20Emission%20Year%202016.pdf)

[^2]: [Global Warming Age Gap: Younger Americans Most Worried](https://news.gallup.com/poll/234314/global-warming-age-gap-younger-americans-worried.aspx)

[^3]: [Do younger generations care more about global warming?](https://climatecommunication.yale.edu/publications/do-younger-generations-care-more-about-global-warming)
